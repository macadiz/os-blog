<div class="max-w-7xl mx-auto p-6">
  <ui-card variant="tight" size="lg">
    <!-- Header -->
    <div class="themed-border border-b px-6 py-4">
      <div class="flex flex-col md:flex-row justify-between items-center">
        <div class="flex flex-col md:flex-row items-center gap-4">
          <h1 class="text-2xl font-bold themed-text">
            {{ currentFilterText }}
          </h1>
          <div class="flex items-center gap-2">
            <span class="text-sm themed-text-secondary">Showing:</span>
            <span class="text-sm font-medium themed-accent">{{
              filteredPosts.length
            }}</span>
            <span class="text-sm text-gray-600"
              >of {{ posts.length }} posts</span
            >
          </div>
        </div>
        <div class="flex items-center gap-3">
          <!-- Filter Toggle - Only show for ADMIN users -->
          <button
            *ngIf="currentUser?.role === 'ADMIN'"
            (click)="togglePostFilter()"
            class="inline-flex items-center px-4 py-2 themed-border border rounded-md shadow-sm text-sm font-medium themed-text themed-surface hover:opacity-80 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"
          >
            <span class="material-symbols-outlined mr-2 text-lg"
              >filter_list</span
            >
            {{ filterButtonText }}
          </button>
          <app-create-button [routerLink]="['new']" text="New Post" />
        </div>
      </div>
    </div>

    <!-- Loading State -->
    <div *ngIf="isLoading" class="p-6">
      <div class="flex justify-center">
        <div class="spinner"></div>
        <span class="ml-2">Loading posts...</span>
      </div>
    </div>

    <!-- Error State -->
    <div *ngIf="errorMessage" class="p-6">
      <div class="alert alert-danger">
        {{ errorMessage }}
      </div>
    </div>

    <!-- Empty State -->
    <div
      *ngIf="!isLoading && !errorMessage && filteredPosts.length === 0"
      class="p-6"
    >
      <div class="text-center py-8">
        <div class="mx-auto h-12 w-12 text-gray-400">
          <span class="material-symbols-outlined text-4xl">article</span>
        </div>
        <h3 class="mt-2 text-sm font-medium text-gray-900">
          {{ showMyPostsOnly ? "No posts by you yet" : "No posts found" }}
        </h3>
        <p class="mt-1 text-sm text-gray-500">
          {{
            showMyPostsOnly
              ? "Get started by creating your first post."
              : "There are no posts in the system yet."
          }}
        </p>
        <div class="mt-6">
          <app-create-button
            [routerLink]="['new']"
            text="Create New Post"
          ></app-create-button>
        </div>
      </div>
    </div>

    <!-- Posts List -->
    <div
      *ngIf="!isLoading && !errorMessage && filteredPosts.length > 0"
      class="overflow-x-auto"
    >
      <table class="min-w-full themed-border border-separate border-spacing-0">
        <thead class="themed-surface">
          <tr>
            <th
              scope="col"
              class="px-6 py-3 text-left text-xs font-medium themed-text-secondary uppercase tracking-wider themed-border border-b"
            >
              Title
            </th>
            <th
              scope="col"
              class="px-6 py-3 text-left text-xs font-medium themed-text-secondary uppercase tracking-wider themed-border border-b"
            >
              Status
            </th>
            <th
              scope="col"
              class="px-6 py-3 text-left text-xs font-medium themed-text-secondary uppercase tracking-wider themed-border border-b"
              *ngIf="!showMyPostsOnly"
            >
              Author
            </th>
            <th
              scope="col"
              class="px-6 py-3 text-left text-xs font-medium themed-text-secondary uppercase tracking-wider themed-border border-b"
            >
              Category
            </th>
            <th
              scope="col"
              class="px-6 py-3 text-left text-xs font-medium themed-text-secondary uppercase tracking-wider themed-border border-b"
            >
              Created
            </th>
            <th scope="col" class="relative px-6 py-3 themed-border border-b">
              <span class="sr-only">Actions</span>
            </th>
          </tr>
        </thead>
        <tbody class="themed-surface">
          <tr *ngFor="let post of filteredPosts; odd as isOdd"
              class="themed-border border-b transition-colors duration-200"
              [class.themed-surface-alt]="isOdd">
            <td class="px-6 py-4 whitespace-nowrap">
              <div class="text-sm font-medium themed-text">
                {{ post.title }}
              </div>
              <div class="text-sm themed-text-secondary">{{ post.slug }}</div>
            </td>
            <td class="px-6 py-4 whitespace-nowrap">
              <span
                class="inline-flex px-2 py-1 text-xs font-semibold rounded-full"
                [class]="
                  post.published
                    ? 'bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400'
                    : 'bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-400'
                "
              >
                {{ post.published ? "Published" : "Draft" }}
              </span>
            </td>
            <td
              class="px-6 py-4 whitespace-nowrap text-sm themed-text"
              *ngIf="!showMyPostsOnly"
            >
              <div class="flex items-center">
                <div class="flex-shrink-0 h-8 w-8">
                  <div
                    class="h-8 w-8 rounded-full bg-blue-500 dark:bg-blue-600 flex items-center justify-center"
                  >
                    <span class="text-sm font-medium text-white">
                      {{ getAuthorInitials(post.author) }}
                    </span>
                  </div>
                </div>
                <div class="ml-3">
                  <div class="text-sm font-medium themed-text">
                    {{ getAuthorName(post.author) }}
                  </div>
                  <div class="text-sm themed-text-secondary">
                    {{ post.author.email }}
                  </div>
                </div>
              </div>
            </td>
            <td class="px-6 py-4 whitespace-nowrap text-sm themed-text">
              {{ post.category?.name || "Uncategorized" }}
            </td>
            <td class="px-6 py-4 whitespace-nowrap text-sm themed-text-secondary">
              {{ post.createdAt | date: "medium" }}
            </td>
            <td
              class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium space-x-2"
            >
              <a
                [routerLink]="['edit', post.id]"
                class="inline-flex items-center px-3 py-1 text-sm bg-blue-100 text-blue-700 rounded hover:bg-blue-200 transition-colors dark:bg-blue-900/30 dark:text-blue-400 dark:hover:bg-blue-900/50"
                *ngIf="canEditPost(post)"
              >
                <span class="material-symbols-outlined text-sm mr-1">edit</span>
                Edit
              </a>
              <button
                (click)="onDelete(post.id)"
                class="inline-flex items-center px-3 py-1 text-sm bg-red-100 text-red-700 rounded hover:bg-red-200 transition-colors dark:bg-red-900/30 dark:text-red-400 dark:hover:bg-red-900/50"
                *ngIf="canDeletePost(post)"
              >
                <span class="material-symbols-outlined text-sm mr-1"
                  >delete</span
                >
                Delete
              </button>
              <span
                *ngIf="!canEditPost(post) && !canDeletePost(post)"
                class="themed-text-secondary text-sm"
              >
                No actions
              </span>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </ui-card>
</div>
