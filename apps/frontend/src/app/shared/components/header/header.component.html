<header class="bg-white shadow-sm border-b border-gray-200">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="flex justify-between items-center h-16">
      <!-- Logo/Brand -->
      <div class="flex items-center">
        <a [routerLink]="['/blog']" class="flex items-center">
          <!-- Dynamic Logo or Fallback Icon -->
          <ng-container *ngIf="blogSettings$ | async as settings">
            <img
              *ngIf="settings.logoUrl; else fallbackIcon"
              [src]="getLogoSrc(settings.logoUrl)"
              [alt]="settings.blogTitle + ' logo'"
              class="h-8 w-auto mr-2"
              loading="lazy"
            />
            <ng-template #fallbackIcon>
              <span
                class="material-symbols-outlined text-blue-600 text-3xl mr-2"
                >article</span
              >
            </ng-template>
          </ng-container>

          <span class="text-xl font-bold text-gray-900">
            {{ (blogSettings$ | async)?.blogTitle || "Open Blog" }}
          </span>
        </a>
      </div>

      <!-- Navigation Links -->
      <nav class="hidden md:flex items-center space-x-8">
        <a
          [routerLink]="['/blog']"
          routerLinkActive="text-blue-600 border-blue-600"
          [routerLinkActiveOptions]="{ exact: true }"
          class="text-gray-600 hover:text-blue-600 px-3 py-2 text-sm font-medium border-b-2 border-transparent transition-colors"
        >
          Blog
        </a>

        <!-- Admin/Author Links (only show if authenticated) -->
        <ng-container *ngIf="currentUser$ | async as user">
          <a
            [routerLink]="['/admin']"
            routerLinkActive="text-blue-600 border-blue-600"
            class="text-gray-600 hover:text-blue-600 px-3 py-2 text-sm font-medium border-b-2 border-transparent transition-colors"
          >
            {{ user.role === "ADMIN" ? "Admin Dashboard" : "Author Dashboard" }}
          </a>

          <a
            [routerLink]="['/admin/posts']"
            routerLinkActive="text-blue-600 border-blue-600"
            [routerLinkActiveOptions]="{ exact: true }"
            class="text-gray-600 hover:text-blue-600 px-3 py-2 text-sm font-medium border-b-2 border-transparent transition-colors"
          >
            My Posts
          </a>

          <a
            [routerLink]="['/admin/posts/new']"
            routerLinkActive="text-blue-600 border-blue-600"
            [routerLinkActiveOptions]="{ exact: true }"
            class="text-gray-600 hover:text-blue-600 px-3 py-2 text-sm font-medium border-b-2 border-transparent transition-colors"
          >
            New Post
          </a>
        </ng-container>
      </nav>

      <!-- User Menu -->
      <div class="flex items-center space-x-4">
        <ng-container *ngIf="currentUser$ | async as user; else loginLink">
          <!-- User Dropdown -->
          <div class="relative" [class.show]="showUserMenu">
            <button
              (click)="toggleUserMenu()"
              class="flex items-center text-sm rounded-full bg-gray-100 hover:bg-gray-200 transition-colors p-2"
            >
              <span class="material-symbols-outlined text-gray-600"
                >person</span
              >
              <span class="ml-2 text-gray-700 font-medium">
                {{
                  user.firstName && user.lastName
                    ? user.firstName + " " + user.lastName
                    : user.username
                }}
              </span>
              <span class="material-symbols-outlined ml-2 text-gray-400"
                >expand_more</span
              >
            </button>

            <!-- Dropdown Menu -->
            <div
              *ngIf="showUserMenu"
              class="absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg border border-gray-200 z-50"
            >
              <div class="py-1">
                <div
                  class="px-4 py-2 text-sm text-gray-500 border-b border-gray-100"
                >
                  {{ user.role === "ADMIN" ? "Administrator" : "Author" }}
                </div>

                <!-- Use reusable dropdown menu items -->
                <ng-container *ngFor="let menuItem of dropdownMenuItems">
                  <div
                    *ngIf="menuItem.label === 'Logout'"
                    class="border-t border-gray-100 mt-1 pt-1"
                  >
                    <app-dropdown-menu-item
                      [item]="menuItem"
                      (itemClick)="closeUserMenu()"
                    >
                    </app-dropdown-menu-item>
                  </div>
                  <app-dropdown-menu-item
                    *ngIf="menuItem.label !== 'Logout'"
                    [item]="menuItem"
                    (itemClick)="closeUserMenu()"
                  >
                  </app-dropdown-menu-item>
                </ng-container>
              </div>
            </div>
          </div>
        </ng-container>

        <!-- Login Link (show when not authenticated) -->
        <ng-template #loginLink>
          <a
            [routerLink]="['/login']"
            class="inline-flex items-center px-4 py-2 border border-blue-600 text-blue-600 rounded-md hover:bg-blue-50 transition-colors"
          >
            <span class="material-symbols-outlined mr-2 text-lg">login</span>
            Login
          </a>
        </ng-template>

        <!-- Mobile menu button -->
        <button
          (click)="toggleMobileMenu()"
          class="md:hidden p-2 rounded-md text-gray-600 hover:text-gray-900 hover:bg-gray-100 transition-colors"
        >
          <span class="material-symbols-outlined">menu</span>
        </button>
      </div>
    </div>

    <!-- Mobile Menu -->
    <div
      *ngIf="showMobileMenu"
      class="md:hidden border-t border-gray-200 pt-4 pb-3"
    >
      <div class="space-y-1">
        <a
          [routerLink]="['/blog']"
          (click)="closeMobileMenu()"
          routerLinkActive="bg-blue-50 text-blue-600"
          [routerLinkActiveOptions]="{ exact: true }"
          class="block px-3 py-2 text-gray-600 hover:text-gray-900 hover:bg-gray-50 rounded-md transition-colors"
        >
          Blog
        </a>

        <ng-container *ngIf="currentUser$ | async as user">
          <a
            [routerLink]="['/admin']"
            (click)="closeMobileMenu()"
            routerLinkActive="bg-blue-50 text-blue-600"
            class="block px-3 py-2 text-gray-600 hover:text-gray-900 hover:bg-gray-50 rounded-md transition-colors"
          >
            {{ user.role === "ADMIN" ? "Admin Dashboard" : "Author Dashboard" }}
          </a>
          <a
            [routerLink]="['/admin/profile']"
            (click)="closeMobileMenu()"
            routerLinkActive="bg-blue-50 text-blue-600"
            class="block px-3 py-2 text-gray-600 hover:text-gray-900 hover:bg-gray-50 rounded-md transition-colors"
          >
            My Profile
          </a>
          <a
            [routerLink]="['/admin/posts']"
            (click)="closeMobileMenu()"
            routerLinkActive="bg-blue-50 text-blue-600"
            class="block px-3 py-2 text-gray-600 hover:text-gray-900 hover:bg-gray-50 rounded-md transition-colors"
          >
            My Posts
          </a>
          <a
            [routerLink]="['/admin/posts/new']"
            (click)="closeMobileMenu()"
            routerLinkActive="bg-blue-50 text-blue-600"
            class="block px-3 py-2 text-gray-600 hover:text-gray-900 hover:bg-gray-50 rounded-md transition-colors"
          >
            New Post
          </a>
          <button
            (click)="logout()"
            class="block w-full text-left px-3 py-2 text-red-600 hover:bg-red-50 rounded-md transition-colors"
          >
            Logout
          </button>
        </ng-container>

        <ng-container *ngIf="!(currentUser$ | async)">
          <a
            [routerLink]="['/login']"
            (click)="closeMobileMenu()"
            class="block px-3 py-2 text-blue-600 hover:bg-blue-50 rounded-md transition-colors"
          >
            Login
          </a>
        </ng-container>
      </div>
    </div>
  </div>
</header>
